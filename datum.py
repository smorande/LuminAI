import pandas as pd
import io
import csv

def clean_data(data_str):
    # Remove any leading/trailing quotes and whitespace
    data_str = data_str.strip('"').strip()
    
    # Create a StringIO object to parse the CSV-like string
    data_io = io.StringIO(data_str)
    
    # Read the data using csv reader to handle proper splitting
    reader = csv.reader(data_io)
    
    # Get headers and data
    headers = next(reader)
    data = list(reader)
    
    # Create DataFrame
    df = pd.DataFrame(data, columns=headers)
    
    # Clean up data
    # Convert date columns to datetime
    date_columns = ['start_dt', 'end_dt', 'settlement_dt', 'contract_dt']
    for col in date_columns:
        df[col] = pd.to_datetime(df[col], format='%m/%d/%Y', errors='coerce')
    
    # Convert numeric columns to appropriate types
    numeric_columns = ['tenor_in', 'tp_amount', 'tp_rate', 'tp_pnl', 'tp_ltd_p']
    for col in numeric_columns:
        df[col] = pd.to_numeric(df[col], errors='coerce')
    
    return df

def save_to_csv(df, output_file='processed_data.csv'):
    """Save the DataFrame to a CSV file"""
    df.to_csv(output_file, index=False)
    print(f"Data has been saved to {output_file}")
    
    # Print some basic statistics
    print("\nDataset Summary:")
    print(f"Total number of records: {len(df)}")
    print(f"Number of unique arrangements: {df['arr_id'].nunique()}")
    print(f"Date range: {df['start_dt'].min()} to {df['end_dt'].max()}")
    print("\nNumeric columns statistics:")
    numeric_cols = ['tp_amount', 'tp_rate', 'tp_pnl', 'tp_ltd_p']
    print(df[numeric_cols].describe())

# Your dataset string would go here
dataset = """[arr_id,goc,tp_mode,txn_ccy,start_dt,end_dt,tenor_in,tp_amount,syc_id,tp_rate,tp_pnl,tp_ltd_p,tp_pseudo,tp_model,is_float,yc_categ,rate_tenor,ccy_days,frs_bu,lv_dmc,arrg_typ,entrps_prod,tp_reversal,zero_rat,pos_mat,frs_affl,src_sys,include_ind,settlement_dt,syc_type,uniq_id,buss_mrt,sub_nam,breakage,citl_lv,pay_freq,data_grc,country_ctp,contract_dt
JAN_RTB_MC1,800,TP_MatchFunded_MDL_33872,NFN,1/1/2021,12/31/2022,729,500,NULL,0,0,0,TP_MatchFunded_MDL_33872_1000,40674,N,729,900,30/360,800905,BR,ARRG_TY_CD_1,ENTRPS_PROD_CD_1,N,12/31/2022,FRS_AFFL_CD,1/5/2021,CHFTP,YY,1/1/2021,SYC,UNIQ_ID_IN_SRC_SYS_11086,MF,n1_crd_ws_dl,0,I1,NULL,I1,BR,1/10/2021
JAN_ONB_26,800,TP_CN_GCB_CitiCredit_PL_CNY,AOA,1/5/2021,12/31/2022,725,-0.01234,9,0,0,0,TP_CN_GCB_CitiCredit_PL_CNY_1000,4153,N,725,900,30/360,800903,BR,ARRG_TY_CD_1,ENTRPS_PROD_CD_1,N,12/31/2022,FRS_AFFL_CD,1/10/2021,CHFTP,YY,1/5/2021,SYC,UNIQ_ID_IN_SRC_SYS_11059,NULL,n1_lns_ws_dl,0,I1,NULL,I1,BR,1/10/2021
JAN_RTB_13,800,TP_MatchFunded_MDL_2147,USD,1/1/2021,12/31/2022,729,0.12345,316,0.191818,0.0000065,0.0000065,TP_MatchFunded_MDL_2147_8_1000,8949,N,729,900,30/360,800903,BR,ARRG_TY_CD_1,ENTRPS_PROD_CD_1,N,12/31/2022,FRS_AFFL_CD,1/10/2021,CHFTP,YY,1/1/2021,SYC,UNIQ_ID_IN_SRC_SYS_039,NULL,n1_lns_ws_dl,0,I1,NULL,I1,BR,1/10/2021
JAN_ONB_25,800,TP_CN_GCB_CitiBusinessLoans,AMD,1/1/2021,12/31/2022,729,11111,7,10.9504,3.27069609,32.7069609,TP_CN_GCB_CitiBusinessLoans_1000,4150,N,729,900,30/360,800902,BR,ARRG_TY_CD_1,ENTRPS_PROD_CD_1,N,12/31/2022,FRS_AFFL_CD,1/10/2021,CHFTP,YY,1/1/2021,SYC,UNIQ_ID_IN_SRC_SYS_11058,NULL,n1_crd_ws_dl,0,I1,NULL,I1,BR,1/10/2021
JAN_ONB_28,800,TP_CN_GCB_MORT_LOANS_FCY,RUB,1/1/2021,12/31/2022,729,150,165,0.475967,0.0191922,0.0191922,TP_CN_GCB_MORT_LOANS_FCY_1000,4159,N,729,900,30/360,800904,BR,ARRG_TY_CD_1,ENTRPS_PROD_CD_1,N,12/31/2022,FRS_AFFL_CD,1/10/2021,CHFTP,YY,1/1/2021,SYC,UNIQ_ID_IN_SRC_SYS_11061,NULL,n1_crd_ws_dl,0,I1,NULL,I1,BR,1/10/2021
JAN_RTB_ADJ1,800,TP_MatchFunded_MDL_33872,NFN,1/1/2021,12/31/2022,729,1000,NULL,10,0.2688172,2.688172,TP_MatchFunded_MDL_33872_1000,40674,N,729,900,30/360,800905,BR,ARRG_TY_CD_1,ENTRPS_PROD_CD_1,N,12/31/2022,FRS_AFFL_CD,1/10/2021,CHFTP,YY,1/1/2021,SYC,UNIQ_ID_IN_SRC_SYS_11086,MF,n1_crd_ws_dl,0,I1,NULL,I1,BR,1/10/2021
JAN_RTB_27,800,TP_MatchFunded_MDL_2147,AOA,1/1/2021,12/31/2022,729,0.12345,9,10.9504,0.0003634,0.0003634,TP_MatchFunded_MDL_2147_8_1000,8949,N,729,900,30/360,800903,BR,ARRG_TY_CD_1,ENTRPS_PROD_CD_1,N,12/31/2022,FRS_AFFL_CD,1/10/2021,CHFTP,YY,1/1/2021,SYC,UNIQ_ID_IN_SRC_SYS_11082,NULL,n1_crd_ws_dl,0,I1,NULL,I1,BR,1/10/2021
JAN_ONB_26,800,TP_CN_GCB_CitiCredit_PL_CNY,AOA,1/10/2021,1/11/2021,1,0.01234,9,9.7,0.0000322,0.0000322,TP_CN_GCB_CitiCredit_PL_CNY_1000,4153,N,1,900,30/360,800903,BR,ARRG_TY_CD_1,ENTRPS_PROD_CD_1,N,12/31/2022,FRS_AFFL_CD,1/10/2021,CHFTP,YY,1/10/2021,SYC,UNIQ_ID_IN_SRC_SYS_11059,MF,n1_lns_ws_dl,0,I1,NULL,I1,BR,1/10/2021
JAN_ONB_24,800,TP_CN_CCDTrade_LOANS_FCY,AMD,1/5/2021,12/31/2022,725,-1101,7,0,0,0,TP_CN_CCDTrade_LOANS_FCY_1000,4148,N,725,900,30/360,800902,BR,ARRG_TY_CD_1,ENTRPS_PROD_CD_1,N,12/31/2022,FRS_AFFL_CD,1/10/2021,CHFTP,YY,1/5/2021,SYC,UNIQ_ID_IN_SRC_SYS_11057,NULL,n1_lns_ws_dl,0,I1,NULL,I1,BR,1/10/2021
JAN_ONB_25,800,TP_CN_GCB_CitiBusinessLoans,AMD,1/10/2021,12/30/2022,719,8889,7,10.9504,0,0,TP_CN_GCB_CitiBusinessLoans_1000,4150,N,719,900,30/360,800902,BR,ARRG_TY_CD_1,ENTRPS_PROD_CD_1,N,12/31/2022,FRS_AFFL_CD,1/10/2021,CHFTP,YY,1/10/2021,SYC,UNIQ_ID_IN_SRC_SYS_11058,NULL,n1_lns_ws_dl,0,I1,NULL,I1,BR,1/10/2021
JAN_RTB_27,800,TP_MatchFunded_MDL_2147,AOA,1/10/2021,12/30/2022,719,-0.00988,9,0.192701,-0.00000291,-0.00000291,TP_MatchFunded_MDL_2147_8_1000,8949,N,719,900,30/360,800903,BR,ARRG_TY_CD_1,ENTRPS_PROD_CD_1,N,12/31/2022,FRS_AFFL_CD,1/10/2021,CHFTP,YY,1/10/2021,SYC,UNIQ_ID_IN_SRC_SYS_11082,MF,n1_crd_ws_dl,0,I1,NULL,I1,BR,1/10/2021
JAN_RTB_13,800,TP_MatchFunded_MDL_2147,USD,1/10/2021,1/11/2021,1,-0.00988,316,0.192701,-0.0000005,-0.0000005,TP_MatchFunded_MDL_2147_8_1000,8949,N,1,900,30/360,800903,BR,ARRG_TY_CD_1,ENTRPS_PROD_CD_1,N,12/31/2022,FRS_AFFL_CD,1/10/2021,CHFTP,YY,1/10/2021,SYC,UNIQ_ID_IN_SRC_SYS_039,MF,n1_lns_ws_dl,0,I1,NULL,I1,BR,1/10/2021
JAN_ONB_25,800,TP_CN_GCB_CitiBusinessLoans,AMD,1/10/2021,12/31/2022,720,-11111,7,9.7,-2.89722312,-2.89722312,TP_CN_GCB_CitiBusinessLoans_1000,4150,N,720,900,30/360,800902,BR,ARRG_TY_CD_1,ENTRPS_PROD_CD_1,N,12/31/2022,FRS_AFFL_CD,1/10/2021,CHFTP,YY,1/10/2021,SYC,UNIQ_ID_IN_SRC_SYS_11058,MF,n1_lns_ws_dl,0,I1,NULL,I1,BR,1/10/2021
JAN_RTB_ADJ1,800,TP_MatchFunded_MDL_33872,NFN,1/10/2021,12/31/2022,720,-1000,NULL,0,0,0,TP_MatchFunded_MDL_33872_1000,40674,N,720,900,30/360,800905,BR,ARRG_TY_CD_1,ENTRPS_PROD_CD_1,N,12/31/2022,FRS_AFFL_CD,1/10/2021,CHFTP,YY,1/10/2021,SYC,UNIQ_ID_IN_SRC_SYS_11086,MF,n1_crd_ws_dl,0,I1,NULL,I1,BR,1/10/2021
JAN_RTB_MIG1,800,TP_MatchFunded_MDL_33872,NFN,1/10/2021,12/30/2022,719,-1000,NULL,0,0,0,TP_MatchFunded_MDL_33872_1000,40674,N,719,900,30/360,800904,BR,ARRG_TY_CD_1,ENTRPS_PROD_CD_1,N,12/31/2022,FRS_AFFL_CD,1/10/2021,CHFTP,YY,1/10/2021,SYC,UNIQ_ID_IN_SRC_SYS_11083,MF,n1_crd_ws_dl,0,I1,NULL,I1,BR,1/10/2021
JAN_RTB_28,800,TP_MatchFunded_MDL_4688,RUB,1/10/2021,12/30/2022,719,-150,165,0.523067,-0.00210914,-0.00210914,TP_MatchFunded_MDL_4688_8_1000,11490,N,719,900,30/360,800902,BR,ARRG_TY_CD_1,ENTRPS_PROD_CD_1,N,12/31/2022,FRS_AFFL_CD,1/10/2021,CHFTP,YY,1/10/2021,SYC,UNIQ_ID_IN_SRC_SYS_11057,NULL,n1_crd_ws_dl,0,I1,NULL,I1,BR,1/10/2021
JAN_ONB_24,800,TP_CN_CCDTrade_LOANS_FCY,AMD,1/1/2021,12/31/2022,729,1111,7,10.9504,3.2704017,3.2704017,TP_CN_CCDTrade_LOANS_FCY_1000,4148,N,729,900,30/360,800905,BR,ARRG_TY_CD_1,ENTRPS_PROD_CD_1,N,12/31/2022,FRS_AFFL_CD,1/1/2021,CHFTP,YY,1/1/2021,SYC,UNIQ_ID_IN_SRC_SYS_11086,NULL,n1_crd_ws_dl,0,I1,NULL,I1,BR,1/10/2021
JAN_RTB_MC1,800,TP_MatchFunded_MDL_33872,NFN,1/5/2021,12/31/2022,725,-500,NULL,0,0,0,TP_MatchFunded_MDL_33872_1000,40674,N,725,900,30/360,800903,BR,ARRG_TY_CD_1,ENTRPS_PROD_CD_1,N,12/31/2022,JAN_RTB_MC1,800,TP_MatchFunded_MDL_33872,NFN,1/5/2021,12/31/2022,725,-500,NULL,0,0,0,TP_MatchFunded_MDL_33872_1000,40674,N,725,900,30/360,800903,BR,ARRG_TY_CD_1,ENTRPS_PROD_CD_1,N,12/31/2022,FRS_AFFL_CD,1/1/2021,CHFTP,YY,1/5/2021,SYC,UNIQ_ID_IN_SRC_SYS_11060,NULL,n1_crd_ws_dl,0,I1,NULL,I1,BR,1/10/2021
JAN_ONB_27,800,TP_CN_GCB_IB_TD_CNY,AOA,1/10/2021,1/11/2021,1,-0.12345,9,9.7,-0.0003219,-0.0003219,TP_CN_GCB_IB_TD_CNY_80090_1000,4157,N,1,900,30/360,800903,BR,ARRG_TY_CD_1,ENTRPS_PROD_CD_1,N,12/31/2022,FRS_AFFL_CD,1/10/2021,CHFTP,YY,1/10/2021,SYC,UNIQ_ID_IN_SRC_SYS_11059,MF,n1_lns_ws_dl,0,I1,NULL,I1,BR,1/10/2021
JAN_ONB_27,800,TP_CN_GCB_IB_TD_CNY,AOA,1/10/2021,1/11/2021,1,-0.00988,9,9.7,-0.0000258,-0.0000258,TP_CN_GCB_IB_TD_CNY_80090_1000,4157,N,1,900,30/360,800903,BR,ARRG_TY_CD_1,ENTRPS_PROD_CD_1,N,12/31/2022,FRS_AFFL_CD,1/10/2021,CHFTP,YY,1/10/2021,SYC,UNIQ_ID_IN_SRC_SYS_11060,MF,n1_lns_ws_dl,0,I1,NULL,I1,BR,1/10/2021]"""

# Process the data
df = clean_data(dataset)

# Save to CSV
save_to_csv(df)